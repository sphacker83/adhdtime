# ADHDTime 개발 플랜 (MVP 실행안)

문서 버전: v2.1  
작성일: 2026-02-28  
기준 문서: `docs/PRD.md` v3.1, `docs/USECASE.md` v2.1

---

## 1. 목표

4주 안에 MVP(P0) 코어 루프를 릴리즈 게이트 통과 수준으로 배포 가능 상태까지 완성한다.

코어 루프:

1. 과업 등록(`totalMinutes`)
2. 청킹
3. 타이머 실행(+ 실행 중 빠른 시간 조정)
4. 보상
5. 복귀(과업 재일정/재청킹)

---

## 2. 고정 전제

- 플랫폼: Next.js(App Router) 기반 모바일 우선 웹앱
- 저장: 로컬 우선(IndexedDB/LocalStorage)
- 과업 생성: `title` + `totalMinutes` 필수
- 청킹: 로컬 패턴 우선 + AI 폴백, `sum(chunks.estMinutes) <= totalMinutes` 강제
- 재일정: 청크 단위 미지원, Task 단위만 지원
- 시간 필드: `createdAt/scheduledFor/startedAt/dueAt/completedAt` 정합 규칙 고정
- 알림(STT 포함): P1
- 범위 원칙: P0 외 요구사항은 백로그로 이관

---

## 3. 우선순위 정책

- P0 must: FR-01 ~ FR-09, FR-11 ~ FR-12
- P1 later: FR-10(알림), STT, 외부 동기화/구독
- 원칙: 릴리즈 게이트와 직접 연결된 항목을 먼저 구현

---

## 4. 4주 로드맵

### Week 1 - 과업 등록/청킹 세로 슬라이스

- 홈 IA 정리(상태 카드/입력/퀘스트 리스트)
- 과업 직접 등록 폼(`title`, `totalMinutes`, `scheduledFor`, `dueAt`) 구현
- 시간 필드 validator(`scheduledFor <= dueAt`, ISO 포맷) 구현
- 로컬 청킹 룰셋 + 스키마 validator 구현
- 청킹 총시간 제약(`sum(estMinutes) <= totalMinutes`) 적용
- AI 폴백 어댑터 연결(실제 호출 또는 모킹)
- UC-01/02 기준 10초/3탭 측정 훅 추가

### Week 2 - 타이머/시간 수정 정책/햅틱 세로 슬라이스

- 타이머 상태 머신 구현(`running/paused/ended`)
- 시작/일시정지/재개/완료 UI/동작 연결
- 실행 중 청크 빠른 `-1분/+1분` 액션 UI 구현
- 실행 전/중 시간 수정 정책 가드(폼 편집 제한, 총시간 증가/감소 규칙) 구현
- 완료 후 다음 청크 자동 포커스
- 백그라운드 복귀 재계산 정책 적용
- 5분 햅틱 + 설정 토글

### Week 3 - 보상/리포트/복귀 세로 슬라이스

- XP/레벨/5스탯 산식 구현
- 완료/복귀 이벤트 기반 보상 반영
- 스탯(리포트) 화면 구현(완료 수/완료율/스탯 변화)
- 복귀 루프 기본(과업 재일정/재청킹) 구현
- 재일정 시 Task 단위 일정 이동 + 미완료 청크 동반 이동 처리
- 복귀 동선 2탭 이내 검증

### Week 4 - 안전/계측/QA/릴리즈

- 이벤트 택소노미 누락 점검 및 보강(`task_time_updated`, `task_rescheduled`, `chunk_time_adjusted`)
- KPI 계산 파이프라인(Activation/Time to Start/Recovery/D1/D7/Time Budget Fit)
- 위험 입력 차단, rawInput 장기 저장 방지 검증
- 시간 필드 정합성 회귀 테스트(`createdAt/scheduledFor/startedAt/dueAt/completedAt`)
- 수동 E2E + 자동화 스모크 테스트 마무리
- 릴리즈 게이트 점검 및 배포 준비

---

## 5. 에픽/티켓 백로그

## Epic A. 홈/과업등록/청킹 (P0)

1. A-01 홈 IA 레이아웃 리팩터링
2. A-02 상태 카드(레벨/달성도/스탯) UI
3. A-03 과업 등록 폼(`title`, `totalMinutes`, `scheduledFor`, `dueAt`)
4. A-04 시간 필드 validator/파서 유틸
5. A-05 로컬 청킹 룰셋(JSON)
6. A-06 청킹 결과 스키마 validator + 총시간 제약
7. A-07 AI 폴백 어댑터
8. A-08 청크 리스트 + 현재 청크 강조

## Epic B. 타이머/실행/시간조정/햅틱 (P0)

1. B-01 타이머 상태 머신
2. B-02 현재 청크 확장 카드 UI
3. B-03 시작/일시정지/재개/완료 액션
4. B-04 실행 중 빠른 `-1분/+1분` 조정
5. B-05 실행 전/중 시간 수정 정책 가드
6. B-06 완료 후 다음 청크 자동 포커스
7. B-07 백그라운드 복귀 시 재계산 정책
8. B-08 5분 햅틱 스케줄러 + 설정 토글

## Epic C. 보상/스탯/리포트 (P0)

1. C-01 XP 계산 유틸 + 레벨업 규칙
2. C-02 5스탯 산식 반영
3. C-03 보상 피드백 UI
4. C-04 스탯(리포트) 화면 카드 구성
5. C-05 이벤트 기반 스탯 동기화

## Epic D. 복귀 루프 (P0)

1. D-01 미완료/중단 상태 전이 설계(`abandoned`, `archived`)
2. D-02 과업 재일정 CTA + `task.scheduledFor` 갱신 처리
3. D-03 재일정 시 미완료 청크 동반 이동 규칙 구현
4. D-04 재청킹 동선 + `parentChunkId` 연결 + 총시간 제약
5. D-05 복귀 행동 보상(회복력/분해력) 반영
6. D-06 비난형 카피 제거 점검

## Epic E. 계측/안전/프라이버시 (P0)

1. E-01 이벤트 택소노미 구현(신규 시간/재일정 이벤트 포함)
2. E-02 KPI 계산 로직(Activation/Time to Start/Recovery/D1/D7/Time Budget Fit)
3. E-03 위험 입력 차단 처리 + `safety_blocked` 이벤트
4. E-04 rawInput 장기 저장 방지(요약 저장 정책)
5. E-05 시간 필드 정합성 체크 유틸
6. E-06 릴리즈 게이트 체크 스크립트(가능 범위 자동화)

## Epic F. QA/릴리즈 (P0)

1. F-01 수동 시나리오 체크리스트 실행
2. F-02 도메인 유틸 테스트(청킹/타이머/XP/시간정합)
3. F-03 컴포넌트 테스트(현재 청크 카드/복귀 CTA/빠른 시간조정)
4. F-04 E2E 스모크(등록->청킹->완료->복귀)
5. F-05 릴리즈 노트 초안/배포 체크

---

## 6. 테스트 전략

### 6.1 수동 필수 시나리오

1. 과업 직접 등록(`title`, `totalMinutes`) + 선택 일정 저장
2. 과업 청킹 생성(10초 이내, 총시간 제약 준수)
3. 실행 전 시간 수정(`task.totalMinutes`, `chunk.estMinutes`) 정상
4. 타이머 일시정지/재개/완료 및 실행 중 빠른 `+/-` 조정
5. 실행 중 `task.totalMinutes` 감소 차단/증가 허용 동작
6. 5분 햅틱 ON/OFF 확인
7. 미완료 -> 과업 재일정/재청킹(2탭 이내)
8. 보상/스탯/리포트 즉시 반영
9. 위험 입력 차단 및 안내 문구
10. 시간 필드 정합성(`completedAt` 존재 조건, 일정 필드 순서) 검증

### 6.2 자동화 우선순위

1. 도메인 테스트: 청킹 스키마, 총시간 제약, 타이머 상태 전이, XP 계산
2. 정책 테스트: 실행 전/중 시간 수정 가드, Task 단위 재일정
3. UI 테스트: 현재 청크 카드, 빠른 시간조정 버튼, 복귀 CTA, 설정 토글
4. E2E 스모크: 핵심 루프 + 복귀 루프 + 시간 필드 검증

---

## 7. 릴리즈 게이트 체크리스트 (MVP)

1. 과업 등록 시 `title`, `totalMinutes` 필수값 검증
2. 청킹 결과 10초 이내 표시 + 총시간 제약 준수
3. 첫 청크 시작 3탭 이내 / 3분 이내
4. 타이머 상태 꼬임 0건 + 실행 중 빠른 `+/-` 동작
5. 햅틱 ON/OFF 정상
6. 보상 및 상태 카드 즉시 반영
7. 복귀 동선(과업 재일정/재청킹) 2탭 이내
8. 재일정이 Task 단위로 동작(청크 단위 재일정 없음)
9. 필수 이벤트 누락 없음
10. rawInput 장기 저장 없음
11. 시간 필드 정합성 규칙 위반 없음

---

## 8. 리스크와 대응

1. 타이머 정확도/상태 꼬임
- 대응: 상태 머신 단일화, 복귀 시각 기준 재계산, 전이 테스트 강화

2. AI 지연/비용
- 대응: 로컬 우선, 호출 상한, 실패 시 템플릿 폴백

3. 범위 팽창
- 대응: P0 freeze, P1 백로그 분리, 주간 범위 점검

4. 안전/프라이버시 누락
- 대응: E-03/E-04를 게이트 필수 항목으로 고정

5. 시간 필드 정합 붕괴
- 대응: E-05 정합 유틸 + 회귀 테스트 + 저장 전 validator 적용

---

## 9. DoD (MVP 완료 정의)

1. FR-01 ~ FR-09, FR-11 ~ FR-12가 동작한다.
2. 릴리즈 게이트 11개 항목을 통과한다.
3. 치명 버그(타이머 꼬임, 데이터 손실, 시작 불가)가 없다.
4. 온보딩 첫 시나리오를 15분 내 완료 가능하다.
5. KPI 계산에 필요한 이벤트가 누락 없이 수집된다.

---

## 10. P1 백로그 (명시적 제외)

- FR-10 알림
- 음성 입력(STT)
- 외부 동기화
- 구독 게이트
